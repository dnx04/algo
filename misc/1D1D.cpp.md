---
data:
  _extendedDependsOn: []
  _extendedRequiredBy: []
  _extendedVerifiedWith: []
  _isVerificationFailed: false
  _pathExtension: cpp
  _verificationStatusIcon: ':warning:'
  attributes:
    links: []
  bundledCode: "#line 1 \"misc/1D1D.cpp\"\nstruct item {\n  int l, r, p;\n};\n\nconst\
    \ int N = 1e5 + 3;\nint n;\nlong long f[N];\n\nlong long w(int j, int i) {\n \
    \ // m\u1ED9t h\xE0m cost b\u1EA5t k\xEC th\u1ECFa m\xE3n b\u1EA5t \u0111\u1EB3\
    ng th\u1EE9c t\u1EE9 gi\xE1c\n}\n\nvoid solve() {\n  deque<item> dq;\n  dq.push_back({1,\
    \ n, 0});\n  for (int i = 1; i <= n; ++i) {\n    f[i] = f[dq.front().p] + w(dq.front().p,\
    \ i);\n    // deque ch\u1EC9 l\u01B0u gi\xE1 tr\u1ECB t\u1EEB h[i + 1]\n    //\
    \ t\u1EDBi h[n]\n    ++dq.front().l;\n\n    // n\u1EBFu l > r, ta lo\u1EA1i \u0111\
    o\u1EA1n n\xE0y kh\u1ECFi deque\n    if (dq.front().l > dq.front().r) {\n    \
    \  dq.pop_front();\n    }\n\n    while (!dq.empty()) {\n      auto [l, r, p] =\
    \ dq.back();\n      if (f[i] + w(i, l) < f[p] + w(p, l)) {\n        dq.pop_back();\n\
    \        // p kh\xF4ng c\xF2n l\xE0 gi\xE1 tr\u1ECB c\u1EE7a\n        // h[l],\
    \ h[l + 1], ..., h[r]\n        // l\xFAc n\xE0y, h[l]=h[l+1]=...=h[r]=i.\n   \
    \   } else\n        break;\n    }\n\n    if (dq.empty()) {\n      dq.push_back({i\
    \ + 1, n, i});\n      // h[i+1]=h[i+2]=...=h[n]=i\n    } else {\n      // t\xEC\
    m nh\u1ECB ph\xE2n v\u1ECB tr\xED pos nh\u1ECF nh\u1EA5t\n      // th\u1ECFa m\xE3\
    n h[pos] = i\n      auto& [l, r, p] = dq.back();\n      int low = l, high = r;\n\
    \      int pos = r + 1, mid;\n      while (low <= high) {\n        mid = (low\
    \ + high) / 2;\n        if (f[i] + w(i, mid) < f[p] + w(p, mid)) {\n         \
    \ pos = mid, high = mid - 1;\n        } else {\n          low = mid + 1;\n   \
    \     }\n      }\n\n      // c\u1EADp nh\u1EADt \u0111o\u1EA1n (l,r,p) th\xE0\
    nh (l,pos-1,p)\n      r = pos - 1;\n      if (pos <= n) {\n        dq.push_back({pos,\
    \ n, i});\n        // h[pos]=h[pos+1]=...=h[n]=i\n      }\n    }\n  }\n}\n"
  code: "struct item {\n  int l, r, p;\n};\n\nconst int N = 1e5 + 3;\nint n;\nlong\
    \ long f[N];\n\nlong long w(int j, int i) {\n  // m\u1ED9t h\xE0m cost b\u1EA5\
    t k\xEC th\u1ECFa m\xE3n b\u1EA5t \u0111\u1EB3ng th\u1EE9c t\u1EE9 gi\xE1c\n}\n\
    \nvoid solve() {\n  deque<item> dq;\n  dq.push_back({1, n, 0});\n  for (int i\
    \ = 1; i <= n; ++i) {\n    f[i] = f[dq.front().p] + w(dq.front().p, i);\n    //\
    \ deque ch\u1EC9 l\u01B0u gi\xE1 tr\u1ECB t\u1EEB h[i + 1]\n    // t\u1EDBi h[n]\n\
    \    ++dq.front().l;\n\n    // n\u1EBFu l > r, ta lo\u1EA1i \u0111o\u1EA1n n\xE0\
    y kh\u1ECFi deque\n    if (dq.front().l > dq.front().r) {\n      dq.pop_front();\n\
    \    }\n\n    while (!dq.empty()) {\n      auto [l, r, p] = dq.back();\n     \
    \ if (f[i] + w(i, l) < f[p] + w(p, l)) {\n        dq.pop_back();\n        // p\
    \ kh\xF4ng c\xF2n l\xE0 gi\xE1 tr\u1ECB c\u1EE7a\n        // h[l], h[l + 1], ...,\
    \ h[r]\n        // l\xFAc n\xE0y, h[l]=h[l+1]=...=h[r]=i.\n      } else\n    \
    \    break;\n    }\n\n    if (dq.empty()) {\n      dq.push_back({i + 1, n, i});\n\
    \      // h[i+1]=h[i+2]=...=h[n]=i\n    } else {\n      // t\xECm nh\u1ECB ph\xE2\
    n v\u1ECB tr\xED pos nh\u1ECF nh\u1EA5t\n      // th\u1ECFa m\xE3n h[pos] = i\n\
    \      auto& [l, r, p] = dq.back();\n      int low = l, high = r;\n      int pos\
    \ = r + 1, mid;\n      while (low <= high) {\n        mid = (low + high) / 2;\n\
    \        if (f[i] + w(i, mid) < f[p] + w(p, mid)) {\n          pos = mid, high\
    \ = mid - 1;\n        } else {\n          low = mid + 1;\n        }\n      }\n\
    \n      // c\u1EADp nh\u1EADt \u0111o\u1EA1n (l,r,p) th\xE0nh (l,pos-1,p)\n  \
    \    r = pos - 1;\n      if (pos <= n) {\n        dq.push_back({pos, n, i});\n\
    \        // h[pos]=h[pos+1]=...=h[n]=i\n      }\n    }\n  }\n}"
  dependsOn: []
  isVerificationFile: false
  path: misc/1D1D.cpp
  requiredBy: []
  timestamp: '2025-11-15 18:26:28+07:00'
  verificationStatus: LIBRARY_NO_TESTS
  verifiedWith: []
documentation_of: misc/1D1D.cpp
layout: document
redirect_from:
- /library/misc/1D1D.cpp
- /library/misc/1D1D.cpp.html
title: misc/1D1D.cpp
---
